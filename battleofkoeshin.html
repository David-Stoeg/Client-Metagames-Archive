<!DOCTYPE html>
<html lang="en-us" style="height: 100%; width: 100%;">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>The Battle of Koeshin</title>
  <link rel="stylesheet" href="unityplayer.css">
</head>
<body>
  <div id="unity-wrapper">
    <canvas id="unity-canvas" width="1055" height="636" tabindex="-1"></canvas>
  </div>
  <script src="./SpiritBlossomBeyond/BattleOfKoeshin/WebGLBuild/Build/WebGLBuild.loader.js"></script>
  <script>
    createUnityInstance(document.querySelector("#unity-canvas"), {
      dataUrl: "https://assetcdn.rgpub.io/public/live/bundle-offload/09648726-b12b-45db-94b8-2af261880ea4/687db99c9787090008ed0602/WebGLBuild/Build/WebGLBuild.data.gz",
      frameworkUrl: ".//SpiritBlossomBeyond/BattleOfKoeshin/WebGLBuild/Build/WebGLBuild.framework.js",
      codeUrl: "https://assetcdn.rgpub.io/public/live/bundle-offload/09648726-b12b-45db-94b8-2af261880ea4/687db99c9787090008ed0602/WebGLBuild/Build/WebGLBuild.wasm.gz",
      streamingAssetsUrl: "https://assetcdn.rgpub.io/public/live/bundle-offload/09648726-b12b-45db-94b8-2af261880ea4/687db99c9787090008ed0602/WebGLBuild/StreamingAssets",
      companyName: "A",
      productName: "B",
      productVersion: "0.1"
    }).then(function (unityInstance) {
      var originalSendMessage = unityInstance.SendMessage;      
      unityInstance.SendMessage("ClientBridge", "SetTelemetryUrl", "");
	  //Set Mission, we only need to set the 1 for the petals so... sorry hardcoding it
	  unityInstance.SendMessage("ClientBridge", "SetMissions", "[{\"internalName\":\"Bloom_GivePetal_1_Hidden\",\"status\":\"SELECT_REWARDS\"}]");
      //Load cached game data if available
      var cachedData = localStorage.getItem("bloomMinigameData");
      if (cachedData) {
        console.log("Loading cached game data:");
        unityInstance.SendMessage("ClientBridge", "SetHubData", cachedData);
        console.log(cachedData);
      } else {
        console.log("No cached game data found.");
		//We need to send blank data otherwise the metagame won't load for some reason
		unityInstance.SendMessage("ClientBridge", "SetHubData", "{}");
      }
	  //Check to see if Spirit Trials has any progress and load each one
	  //Actually turns out this isn't needed but will be leaving it here just incase.
	  /*_UpdateSpiritTrialsProgress(unityInstance, "Irelia_Reward_Group", "e22c5db0-8f16-40bc-946a-09670209b168", "9d2f71a2-4116-43f5-9e85-574de503b910");
	  _UpdateSpiritTrialsProgress(unityInstance, "Karma_Reward_Group", "1c05b69a-ed65-450a-a71b-e11d79fac86e", "86243285-3f29-40dc-b586-ddbd373328bc");
	  _UpdateSpiritTrialsProgress(unityInstance, "Kayle_Reward_Group", "7498bf9c-47a5-4505-9cf3-a6bedd6601c5", "b04541c4-8d72-4246-8757-edc0dcb85b70");
	  _UpdateSpiritTrialsProgress(unityInstance, "Zed_Reward_Group", "3bf2704f-465a-40be-9740-5165cba7fff9", "7e1f5e76-a4ed-4e84-ba65-330d1d960206");*/
    }).catch(function (message) {
      console.error(message);
    });
	function _UpdateSpiritTrialsProgress(unityInstance, RewardGroup, CounterId, GroupId) {
		var cachedData = localStorage.getItem(RewardGroup);
		if(cachedData == null)
		{
			//Initialize the Counter:
			cachedData = 0;
			localStorage.setItem(RewardGroup, cachedData);
		}
		const payload = JSON.stringify({
			counters:[ {
				counterId: CounterId,
				counterValue: cachedData,
				groupId: GroupId,
				productId: "d1c2664a-5938-4c41-8d1b-61fd51052c22" //League of Legends Product Id
			}],
			groupId: GroupId
		});
		console.log(payload);
		unityInstance.SendMessage("ClientBridge", "SetProgressTrack", payload);
	};
  </script>
</body>
</html>
